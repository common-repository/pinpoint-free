!function(t,e){var n;"function"==typeof define&&define.amd?define("Pinner",["module"],e):"undefined"!=typeof exports?e(module):(e(n={exports:{}}),t.Pinner=n.exports)}(this,function(t){"use strict";function e(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&n(t,e)}function n(t,e){return(n=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function r(n){var i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}();return function(){var t,e=a(n);return s(this,i?(t=a(this).constructor,Reflect.construct(e,arguments,t)):e.apply(this,arguments))}}function s(t,e){return!e||"object"!==l(e)&&"function"!=typeof e?c(t):e}function c(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function a(t){return(a=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function i(t){return function(t){if(Array.isArray(t))return o(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"==typeof t)return o(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return o(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function o(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=new Array(e);n<e;n++)i[n]=t[n];return i}function l(t){return(l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function u(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function h(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function p(t,e,n){return e&&h(t.prototype,e),n&&h(t,n),t}var d=(p(f,[{key:"remove",value:function(){return!!this.cache.pin&&(this.cache.pin.remove(),!0)}}]),f);function f(){u(this,f),this.cache={}}var m=(p(b,[{key:"setImage",value:function(t){this.image=t.url,this.title=t.title,this.render(!0)}},{key:"addPin",value:function(t){if(t instanceof d){var e=t.render();return e.classList.add("pinner__pin"),this.element.append(e),this.pins.push(t),t}return console.error("Error: pin must be of type Pin!"),!1}},{key:"deletePin",value:function(t){return!!this.pins[t]&&(this.pins[t].remove(),this.pins=[].concat(i(this.pins.slice(0,t)),i(this.pins.slice(t+1))),!0)}},{key:"clear",value:function(){this.pins.map(function(t){t.remove()}),this.pins=[]}},{key:"addParser",value:function(t){this.parsers[t.type]=t}},{key:"parsePins",value:function(t){t=t||this.parsers;for(var e=[],n=this.element.children,i=0;i<n.length;i++){var a,r=n[i],s="";t[s=r.hasAttribute("data-parser")?r.getAttribute("data-parser"):"default"]?(a=t[s].parser(r),e.push(new t[s].class(a))):console.error('Error: pin parser of type "'.concat(s,'" does not exist.'))}return e}},{key:"render",value:function(){var n=this;this.element.innerHTML="";var t=document.createElement("img");t.className="pinner__image",t.setAttribute("src",this.image),this.element.setAttribute("data-image",this.image),t.setAttribute("alt",this.title),this.element.setAttribute("data-title",this.title),this.element.append(t),this.pins.map(function(t){var e=t.render();e.classList.add("pinner__pin"),n.element.append(e)})}}]),b);function b(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};u(this,b);var n=null;if("object"===l(t)?n=t:"string"==typeof t&&(n=document.querySelector(t)),n&&n instanceof Element)return this.image=n.hasAttribute("data-image")?n.getAttribute("data-image"):"",this.title=n.hasAttribute("data-title")?n.getAttribute("data-title"):"",this.parsers=e.parsers||{},this.element=n,e.onclick&&n.addEventListener("click",e.onclick),this.pins=this.parsePins(),n.classList.add("pinner"),n.classList.add("pinner_loaded"),this.render(),this;console.error("Error: invalid block.")}var v={},y={Space:function(){e(a,m);var i=r(a);function a(t){var e,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};return u(this,a),n.parsers?n.parsers=Object.assign({},n.parsers,v):n.parsers=v,s(e=i.call(this,t,n),c(e))}return a}(),addParser:function(t){v[t.name]=t},Pin:d};"function"!=typeof Element.remove&&(Element.prototype.remove=function(){this.parentElement.removeChild(this)}),"function"!=typeof NodeList.remove&&(NodeList.prototype.remove=HTMLCollection.prototype.remove=function(){for(var t=this.length-1;0<=t;t--)this[t]&&this[t].parentElement&&this[t].parentElement.removeChild(this[t])}),"function"!=typeof Element.append&&(Element.prototype.append=Element.prototype.appendChild),[Element.prototype,Document.prototype,DocumentFragment.prototype].forEach(function(t){t.hasOwnProperty("prepend")||Object.defineProperty(t,"prepend",{configurable:!0,enumerable:!0,writable:!0,value:function(){var t=Array.prototype.slice.call(arguments),n=document.createDocumentFragment();t.forEach(function(t){var e=t instanceof Node;n.appendChild(e?t:document.createTextNode(String(t)))}),this.insertBefore(n,this.firstChild)}})}),"function"!=typeof Object.assign&&Object.defineProperty(Object,"assign",{value:function(t,e){if(null==t)throw new TypeError("Cannot convert undefined or null to object");for(var n=Object(t),i=1;i<arguments.length;i++){var a=arguments[i];if(null!=a)for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(n[r]=a[r])}return n},writable:!0,configurable:!0});function g(t){if(!t)return{};var e={};return t.hasAttribute("data-color")&&(e.color=t.getAttribute("data-color")),e.label=t.innerHTML||k.label,e.custom_class=t.className||"",t.hasAttribute("href")&&(e.link=t.getAttribute("href")||k.href),t.hasAttribute("data-shape")&&(e.shape=t.getAttribute("data-shape")||k.shape),t.hasAttribute("data-stamp")&&(e.stamp=t.getAttribute("data-stamp")||k.stamp),t.hasAttribute("data-size")&&(e.size=t.getAttribute("data-size")||k.size),t.hasAttribute("data-trigger")&&(e.x=t.getAttribute("data-trigger")||k.trigger),t.hasAttribute("data-x")&&(e.x=t.getAttribute("data-x")||k.x),t.hasAttribute("data-y")&&(e.y=t.getAttribute("data-y")||k.y),e}var k={color:"#222222",label:"(no content)",link:"#",shape:"circle",stamp:null,size:"24px",theme:"dark",x:"50%",y:"50%",trigger:"hover",custom_class:""},A=function(){e(i,d);var n=r(i);function i(){var t,e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return u(this,i),(t=n.call(this,e)).state=Object.assign({},k,e),s(t,c(t))}return p(i,[{key:"setLink",value:function(t){var e=0<arguments.length&&void 0!==t?t:k.link;this.cache.pin&&this.cache.pin.setAttribute("href",e),this.state.link=e}},{key:"setLabel",value:function(t){var e,n=0<arguments.length&&void 0!==t?t:k.label;this.cache.label?this.cache.label.innerHTML=n:this.cache.pin&&((e=document.createElement("span")).className="link-pin__label",e.innerHTML=n,this.cache.pin.append(e),this.cache.label=e),this.state.label}},{key:"setSize",value:function(t){var e=0<arguments.length&&void 0!==t?t:k.href;this.cache.bullet&&(this.cache.bullet.style.width=e,this.cache.bullet.style.height=e),this.cache.stamp&&(this.cache.stamp.style.lineHeight=e),this.cache.pin&&(this.cache.pin.style.fontSize=e,this.cache.pin.setAttribute("data-size",e)),this.state.size=e}},{key:"setShape",value:function(t){var e=0<arguments.length&&void 0!==t?t:k.shape;this.cache.bullet&&(this.cache.bullet.classList.remove("link-pin__bullet_".concat(this.state.shape)),this.cache.bullet.classList.add("link-pin__bullet_".concat(e)),this.cache.pin.setAttribute("data-shape",e)),this.state.shape=e}},{key:"setColor",value:function(t){var e=0<arguments.length&&void 0!==t?t:k.color;this.cache.pin&&(this.cache.pin.style.color=e,this.cache.pin.setAttribute("data-color",e)),this.state.color=e}},{key:"setTheme",value:function(t){var e=0<arguments.length&&void 0!==t?t:k.theme;this.cache.pin&&(this.cache.pin.classList.remove("link-pin_".concat(this.state.theme)),this.cache.pin.classList.add("link-pin_".concat(e)),this.cache.pin.setAttribute("data-theme",e)),this.state.theme=e}},{key:"setStamp",value:function(t){var e,n=0<arguments.length&&void 0!==t?t:k.stamp;this.cache.stamp?this.cache.stamp.innerHTML=n:this.cache.pin&&((e=document.createElement("span")).innerHTML=n,e.className="link-pin__stamp",e.style.lineHeight=this.state.size,this.cache.pin.append(e),this.cache.stamp=e,this.cache.pin.setAttribute("data-stamp",n)),this.state.stamp=n}},{key:"removeStamp",value:function(){this.cache.stamp&&(this.cache.stamp.remove(),this.cache.stamp=null),this.cache.pin&&this.cache.pin.removeAttribute("data-stamp",stamp),this.state.stamp=null}},{key:"setX",value:function(t){var e=0<arguments.length&&void 0!==t?t:k.x;this.cache.pin&&(this.cache.pin.style.left=e,this.cache.pin.setAttribute("data-x",e)),this.state.x=e}},{key:"setY",value:function(t){var e=0<arguments.length&&void 0!==t?t:k.y;this.cache.pin&&(this.cache.pin.style.top=e,this.cache.pin.setAttribute("data-y",e)),this.state.y=e}},{key:"setTrigger",value:function(t){this.trigger=t}},{key:"render",value:function(t){t=t||this.state;var e,n,i,a,r,s,c,o=document.createElement("a"),l=t.link?t.link:k.link;o.setAttribute("href",l),e=t.custom_class?t.custom_class:k.custom_class,o.className="link-pin ".concat(e),n=t.theme?t.theme:k.theme,o.classList.add("link-pin_".concat(n)),o.setAttribute("data-theme",n),i=t.color?t.color:k.color,o.style.color=i,o.setAttribute("data-color",n),a=t.x?t.x:k.x,o.style.left=a,o.setAttribute("data-x",a),r=t.y?t.y:k.y,o.style.top=r,o.setAttribute("data-y",r),(s=t.label?t.label:k.label)&&((c=document.createElement("span")).className="link-pin__label",c.innerHTML=s,o.append(c),this.cache.label=c);var u,h,p,d,f,m,b=document.createElement("span");return b.className="link-pin__bullet",u=t.shape?t.shape:k.shape,b.classList.add("link-pin__bullet_".concat(u)),o.setAttribute("data-shape",u),h=t.size?t.size:k.size,b.style.width=h,b.style.height=h,b.style.fontSize=h,o.setAttribute("data-size",h),(p=t.stamp?t.stamp:k.stamp)&&((d=document.createElement("span")).innerHTML=p,d.className="link-pin__stamp",d.style.lineHeight=h,b.append(d),o.setAttribute("data-stamp",p),this.cache.stamp=d),o.prepend(b),this.cache.bullet=b,"click"==(f=t.trigger?t.trigger:k.trigger)||"ontouchstart"in window?(m=!1,o.addEventListener("click",function(t){return m?(t.currentTarget.classList.remove("link-pin_active"),void(m=!1)):(t.preventDefault(),t.currentTarget.classList.add("link-pin_active"),void(m=!0))})):"hover"==f&&(o.addEventListener("mouseover",function(t){t.currentTarget.classList.add("link-pin_active")}),o.addEventListener("mouseleave",function(t){t.currentTarget.classList.remove("link-pin_active")})),document.addEventListener("click",function(t){var e=function t(e,n){return e.classList&&e.classList.contains(n)?e:!!e.parentNode&&t(e.parentNode,n)}(t.target,"link-pin");e&&e==o||o.classList.remove("link-pin_active")}),o.setAttribute("data-trigger",f),this.cache.pin=o}}]),i}();window.addEventListener("load",function(t){y.addParser({name:"default",class:A,parser:g});for(var e=document.querySelectorAll(".pinner"),n=0;n<e.length;n++)e[n].classList.contains("pinner_loaded")||new y.Space(e[n])}),t.exports=Object.assign({},y,{LinkPin:A})});
